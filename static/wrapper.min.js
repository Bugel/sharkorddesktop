!function(){const e=window.sharkordDesktop,t=document.getElementById("sidebar"),n=document.getElementById("client-container");var i="camera; microphone; display-capture";window.addEventListener("message",function(t){t.data&&("sharkord-ptt"===t.data.type&&"boolean"==typeof t.data.pressed&&e&&e.pttState?e.pttState(t.data.pressed):"sharkord-add-server"===t.data.type&&t.data.url?function(t){var n=t.url,i=t.name||(n?function(){try{return new URL(n).hostname}catch(e){return"Server"}}():"Server");if(!n||!e.addServer)return;!function(e,t){ue={url:e,name:t};var n=document.getElementById("add-server-confirm-text");n&&(n.textContent='Would you like to add "'+t+'" ('+e+") to your server panel?");document.getElementById("add-server-confirm-modal").classList.add("open")}(n.startsWith("http://")||n.startsWith("https://")?n:"https://"+n,i)}(t.data):"sharkord-request-communities-db"===t.data.type&&t.data.url&&e&&e.fetchCommunitiesDatabase&&t.source?e.fetchCommunitiesDatabase(t.data.url).then(function(e){try{t.source.postMessage({type:"sharkord-communities-db-response",data:e,lastRefreshed:(new Date).toISOString()},"*")}catch(e){}}).catch(function(){try{t.source.postMessage({type:"sharkord-communities-db-response",data:null},"*")}catch(e){}}):"sharkord-refresh-communities"===t.data.type&&e&&e.refreshCommunitiesCache&&v?(v.src="about:blank",setTimeout(function(){e.refreshCommunitiesCache().then(function(t){t&&e.getCommunitiesPageUrl&&v?e.getCommunitiesPageUrl().then(function(e){e&&v&&(v.src=e)}):v&&(v.src="communities/test.html")})},100)):"sharkord-copy-to-clipboard"===t.data.type&&"string"==typeof t.data.text&&function(e){var t=document.getElementById("copy-text-input"),n=document.getElementById("copy-text-modal");t&&(t.value=e||"");n&&n.classList.add("open");t&&(t.focus(),t.select())}(t.data.text))});var r=null,o=null,a=null;function c(){e&&e.getDevicePreferences&&e.pttState&&(o&&(document.removeEventListener("keydown",o,!0),document.removeEventListener("keyup",a,!0),o=a=null),r=null,e.getDevicePreferences().then(function(t){var n=t&&t.pttBinding;n&&0===String(n).indexOf("Key")&&(r=n,o=function(t){t.code===r&&(t.preventDefault(),t.stopPropagation(),e.pttState(!0))},a=function(t){t.code===r&&(t.preventDefault(),t.stopPropagation(),e.pttState(!1))},document.addEventListener("keydown",o,!0),document.addEventListener("keyup",a,!0))}))}if(e&&c(),!e||!e.getServers||!e.getServerUrl){var d=document.createElement("iframe");return d.className="client-frame active",d.title="Sharkord",d.allow=i,d.setAttribute("tabindex","0"),d.src="https://demo.sharkord.com",void n.appendChild(d)}let s=[],l="";var u=null,m=!1,v=null;function f(e){try{return new URL(e).origin}catch{return e}}function p(e){return e.id===u}function g(){return u?s.find(function(e){return e.id===u}):null}function y(t){t.addEventListener("load",function(){if(t.classList.contains("active")&&(t.setAttribute("tabindex","0"),t.focus(),e.focusActiveClientFrame)){var n=g(),i=n&&n.url?n.url:t.src||"";setTimeout(function(){e.focusActiveClientFrame(i)},50)}})}function E(){if(0===s.length){n.querySelectorAll(".client-frame").forEach(function(e){e.remove()}),(a=n.querySelector(".empty-state"))&&a.remove();var e=document.createElement("div");return e.className="empty-state",e.textContent="There are no saved servers to connect to! Join a community using the plus icon located on the bottom of the server panel!",void n.appendChild(e)}var t=n.querySelector(".empty-state");t&&t.remove();var r=function(){if(0===s.length)return[];if(!g())return[];var e=s.filter(function(e){return e.id===u||e.keepConnected}).map(function(e){return e.id});return 0!==e.indexOf(u)&&(e=e.filter(function(e){return e!==u})).unshift(u),e}(),o=Array.from(n.querySelectorAll(".client-frame")).filter(function(e){return e.dataset.serverId});if(0===r.length){var a,c=g();n.querySelectorAll(".client-frame").forEach(function(e){e.remove()}),(a=n.querySelector(".empty-state"))&&a.remove();var d=document.createElement("iframe");return d.className="client-frame active",d.title="Sharkord",d.allow=i,d.setAttribute("tabindex","0"),y(d),d.src=c?c.url:l,void n.appendChild(d)}var m={};r.forEach(function(e){m[e]=!0}),o.forEach(function(e){var t=e.dataset.serverId;m[t]||e.remove()}),r.forEach(function(e){var t=n.querySelector('.client-frame[data-server-id="'+e+'"]');if(t)t.classList.toggle("active",e===u);else{var r=s.find(function(t){return t.id===e});if(r){var o=document.createElement("iframe");o.className="client-frame"+(e===u?" active":""),o.title=r.name,o.allow=i,o.setAttribute("tabindex","0"),o.dataset.serverId=r.id,y(o),o.src=r.url,n.appendChild(o)}}}),n.querySelectorAll(".client-frame").forEach(function(e){e.classList.toggle("active",e.dataset.serverId===u)})}function h(t){m=!1,n.classList.remove("communities-active"),l=t.url,u=t.id,x=t.id,e.setServerUrl(t.url),n.querySelector('.client-frame[data-server-id="'+t.id+'"]')?n.querySelectorAll(".client-frame").forEach(function(e){e.classList.toggle("active",e.dataset.serverId===t.id)}):E(),J()}function L(e){return"string"==typeof e&&0===e.indexOf("data:image/")}let I=null;var k=null,B=null,b=null,C=!1,x=null,A=null,w=null,S=!1,D=null,M=null,T=80;function P(){document.querySelectorAll(".server-btn-drag-clone").forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)})}function N(e,n){if(D){var i=t.getBoundingClientRect().top+H+22,r=Math.max(n,i);D.style.left=e+"px",D.style.top=r+"px"}}function q(e,t){return{x:e.left+e.width/2,y:e.top+H+t*V+22}}function O(e,t,n){if(t.length&&1!==t.length){e.style.transition="left "+T/1e3+"s ease-out, top "+T/1e3+"s ease-out";var i=0;requestAnimationFrame(function(){r()})}else n&&n();function r(){if(++i>=t.length)n&&n();else{var o=t[i];e.style.left=o.x+"px",e.style.top=o.y+"px";var a=!1;e.addEventListener("transitionend",c),setTimeout(function(){a||c()},T+30)}function c(){a||(a=!0,e.removeEventListener("transitionend",c),r())}}}var U=250;function R(e,t){e&&e.dataset.serverId!==A&&(e.classList.remove("nudge-down","nudge-up"),e.offsetWidth,e.classList.add(t),setTimeout(function(){e.classList.remove("nudge-down","nudge-up")},U))}function j(e,n){if(e){var i=[];t.querySelectorAll(".server-btn").forEach(function(t){var n=t.dataset.serverId;if(n){var r=e.indexOf(n);t.style.order=String(r>=0?r:999),r>=0&&(i[r]=t)}}),n&&i.forEach(function(e,t){if(e){var r=e.dataset.serverId;if(r!==A){var o=n.indexOf(r);if(-1!==o&&o!==t){var a=t>o?"nudge-down":"nudge-up";R(e,a);var c=t-1;c>=0&&i[c]&&R(i[c],a)}}}})}}var H=8,V=48;function F(e,n){if(n<=0)return 0;var i=t.getBoundingClientRect().top+H;return e<=i?0:e>=i+n*V?n-1:Math.min(n-1,Math.max(0,Math.floor((e-i)/V)))}function z(e,n){if(A&&w&&0!==w.length){w.length;var i=function(e,n,i){if(!i||0===i.length)return 0;var r=Array.from(t.querySelectorAll(".server-btn")).filter(function(e){return e.dataset.serverId&&!e.classList.contains("dragging")});if(0===r.length)return F(n,i.length);r.sort(function(e,t){return e.getBoundingClientRect().top-t.getBoundingClientRect().top});for(var o=0;o<r.length;o++){var a=r[o].getBoundingClientRect();if(n>=a.top&&n<=a.bottom&&e>=a.left&&e<=a.right){var c=r[o].dataset.serverId,d=i.indexOf(c);return d>=0?d:F(n,i.length)}}return F(n,i.length)}(e,n,w),r=A,o=w.indexOf(r);if(-1!==o&&o!==i){var a=w.slice();w.splice(o,1),w.splice(i,0,r),j(w,a)}}}var W=null,K=null,X=null,Y=null;function G(){var e=W;if(e&&K&&X){var t=e.scrollTop>0,n=e.scrollTop+e.clientHeight<e.scrollHeight;K.classList.toggle("visible",t),X.classList.toggle("visible",n)}}function J(){Y&&W&&(Y.disconnect(),Y=null),t.innerHTML="",W=null,K=null,X=null;var n=document.createElement("div");n.className="sidebar-scroll-arrow",n.setAttribute("aria-hidden","true"),n.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>';var i=document.createElement("div");i.className="sidebar-scroll-viewport";var r=document.createElement("div");r.className="sidebar-scroll-arrow",r.setAttribute("aria-hidden","true"),r.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>',K=n,W=i,X=r;var o=document.createElement("div");o.className="sidebar-scroll-region",o.appendChild(n),o.appendChild(i),o.appendChild(r),t.appendChild(o),s.forEach(function(n){const r=document.createElement("button");r.type="button",r.draggable=!0,r.dataset.serverId=n.id;var o=function(e){return e.icon&&e.icon.trim()?e.icon.trim():(e.name||"?").charAt(0).toUpperCase()}(n),a=L(o),c=!a&&(o.length>1||1===o.length&&o.charCodeAt(0)>127),d=p(n)&&x===n.id;r.className="server-btn"+(d?" ripple-pending":p(n)?" active":"")+(c?" icon-emoji":"")+(a?" icon-image":"");var l=[];if(n.identity&&l.push("saved login"),n.keepConnected&&l.push("keep connected"),r.title=n.name+(l.length?" ("+l.join(", ")+")":"")+" ‚Äî drag to reorder",a){var v=document.createElement("img");v.src=o,v.alt=n.name||"",v.className="server-btn-icon-img",r.appendChild(v)}else{var f=document.createElement("span");f.className="server-btn-icon",f.textContent=o,r.appendChild(f)}r.addEventListener("click",function(){C?C=!1:(n.id!==u||m)&&h(n)});var g=null;r.addEventListener("dragstart",function(e){A=n.id,w=s.map(function(e){return e.id}),S=!1,t.classList.add("reordering"),document.body.classList.add("sharkord-dragging"),e.dataTransfer.setData("text/plain",n.id),e.dataTransfer.effectAllowed="move",e.dataTransfer.setDragImage((M||((M=new Image).src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"),M),0,0),j(w),r.classList.add("dragging"),P();var i=r.cloneNode(!0);i.classList.add("server-btn-drag-clone"),i.setAttribute("aria-hidden","true"),i.style.left=e.clientX+"px",i.style.top=e.clientY+"px",document.body.appendChild(i),D=i,g=function(e){e.preventDefault(),e.dataTransfer.dropEffect="move",z(e.clientX,e.clientY),N(e.clientX,e.clientY)},document.addEventListener("dragover",g,!0)}),r.addEventListener("dragend",function(){function n(){A&&(document.body.classList.remove("sharkord-dragging"),D&&D.parentNode&&D.parentNode.removeChild(D),D=null,P(),!S&&w&&w.length&&e.reorderServers&&e.reorderServers(w.slice()).then(function(e){s=Array.isArray(e)?e:s,J()}),A=null,w=null,S=!1,t.classList.remove("reordering"),r.classList.remove("dragging"),t.querySelectorAll(".server-btn").forEach(function(e){e.classList.remove("drag-over")}),t.querySelectorAll(".server-btn").forEach(function(e){e.style.order=""}),C=!0,setTimeout(function(){C=!1},200))}if(g&&(document.removeEventListener("dragover",g,!0),g=null),setTimeout(function(){document.querySelector(".server-btn-drag-clone")&&(P(),n())},3e3),D&&w&&A&&!S){var i=t.getBoundingClientRect(),o=w.length,a=D.getBoundingClientRect(),c=a.top+22,d=a.left+22,l=F(c,o),u=w.indexOf(A);if(u<0&&(u=0),l!==u&&!(0===u&&l===o-1)&&!(u===o-1&&0===l)){var m=w.slice(),v=w.indexOf(A);-1!==v&&(w.splice(v,1),w.splice(l,0,A),j(w,m)),u=l}var f,p=F(c,o),y=[{x:d,y:c}];if(p<u)for(f=p+1;f<=u;f++)y.push(q(i,f));else if(p>u)for(f=p-1;f>=u;f--)y.push(q(i,f));else y.push(q(i,u));O(D,y,n),setTimeout(function(){D&&D.parentNode&&n()},2500)}else n()}),r.addEventListener("dragover",function(e){e.preventDefault(),e.dataTransfer.dropEffect="move",N(e.clientX,e.clientY);var t=A;if(t&&t!==n.id){r.classList.add("drag-over");var i=w?w.slice():s.map(function(e){return e.id}),o=i.indexOf(t),a=i.indexOf(n.id);if(-1!==o&&-1!==a){var c=i.slice();i.splice(o,1),i.splice(a,0,t),j(w=i,c)}}}),r.addEventListener("dragleave",function(){r.classList.remove("drag-over")}),r.addEventListener("drop",function(t){if(t.preventDefault(),r.classList.remove("drag-over"),(A||t.dataTransfer.getData("text/plain"))&&e.reorderServers){S=!0;var n=w&&w.length?w.slice():s.map(function(e){return e.id});e.reorderServers(n).then(function(e){s=Array.isArray(e)?e:s,J()})}}),r.addEventListener("contextmenu",function(e){e.preventDefault(),I=n.id;var t=document.getElementById("server-context-menu"),i=document.getElementById("context-keep-connected");i&&(i.textContent=n.keepConnected?"Keep connected ‚úì":"Keep connected"),t.classList.add("open"),t.style.left=e.clientX+"px",t.style.top=e.clientY+"px"}),i.appendChild(r)}),i.addEventListener("scroll",G),"undefined"!=typeof ResizeObserver&&(Y=new ResizeObserver(function(){G()})).observe(i),requestAnimationFrame(function(){G()});var a=document.createElement("div");a.className="sidebar-footer-actions";var c=document.createElement("div");c.className="drag-trash-btn",c.setAttribute("aria-hidden","true"),c.title="Remove from list (drag server here)",c.innerHTML='<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>',c.addEventListener("dragover",function(e){e.preventDefault(),e.dataTransfer.dropEffect="move",c.classList.add("drag-over-trash")}),c.addEventListener("dragleave",function(){c.classList.remove("drag-over-trash")}),c.addEventListener("drop",function(t){t.preventDefault(),c.classList.remove("drag-over-trash");var n=A||t.dataTransfer.getData("text/plain");n&&e.removeServer&&(S=!0,e.removeServer(n),ze())}),a.appendChild(c);var d=document.createElement("button");d.type="button",d.className="communities-btn"+(m?" active":""),d.title="Communities",d.innerHTML='<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 4.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5z"/><path d="M7 7a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/><path d="M17 7a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/><path d="M12 12c-1.5 0-3 .8-3 2v2h6v-2c0-1.2-1.5-2-3-2z"/><path d="M7 14c-1 0-2 .5-2 1.5v1.5h4v-1.5c0-1-.5-1.5-2-1.5z"/><path d="M17 14c-1 0-2 .5-2 1.5v1.5h4v-1.5c0-1-.5-1.5-2-1.5z"/></svg>',d.addEventListener("click",le),a.appendChild(d);var l=document.createElement("button");l.type="button",l.id="sidebar-settings-btn",l.className="settings-btn",l.title="Media devices (microphone, speaker, camera)",l.textContent="‚öô",l.addEventListener("click",pe),a.appendChild(l);var v=document.createElement("button");v.type="button",v.className="add-btn",v.title="Add server",v.textContent="+",v.addEventListener("click",Q),a.appendChild(v),t.appendChild(a)}function Q(){var e=document.getElementById("add-server-modal"),t=document.getElementById("add-server-input");t.value="",e.classList.add("open"),t.focus()}function Z(){document.getElementById("add-server-modal").classList.remove("open")}function $(){var t=function(e){var t=(e||"").trim();return t?t.startsWith("http://")||t.startsWith("https://")?t:"https://"+t:null}((document.getElementById("add-server-input").value||"").trim());if(t){try{var n=new URL(t).hostname}catch(e){return}Z(),e.addServer({url:t,name:n}).then(function(e){s=Array.isArray(e)?e:[];var n=s.find(function(e){return f(e.url)===f(t)});n?h(n):ze()})}}var _,ee,te,ne,ie=["üêü","ü¶à","üê≥","üîµ","üü¢","üü°","üü†","üî¥","üíú","üü£","üè†","‚≠ê","üåô","‚òÄÔ∏è","üéÆ","üí¨","üìÅ","üîí","üéµ","üé§","üì∑","üöÄ","‚ù§Ô∏è","‚ú®","üî•","üí°","üéØ","üåü","üé®","üìå","üåà","‚ö°","üèÜ","üé™","üé≠","üòÄ","üëç","üéâ","üîî","üì¨","üåç","üõ°Ô∏è","‚öôÔ∏è","üîß"];function re(e){var t=s.find(function(t){return t.id===e});if(t){var n;B=e,b=L(t.icon)?t.icon:null,(n=document.getElementById("change-icon-emoji-grid")).innerHTML||ie.forEach(function(e){var t=document.createElement("span");t.textContent=e,t.title=e,t.addEventListener("click",function(){b=null;var t=document.getElementById("change-icon-preview-wrap");t&&t.classList.remove("visible"),document.getElementById("change-icon-input").value=e,document.getElementById("change-icon-emoji-picker").classList.remove("open")}),n.appendChild(t)});var i=document.getElementById("change-icon-input"),r=document.getElementById("change-icon-preview-wrap"),o=document.getElementById("change-icon-preview"),a=document.getElementById("change-icon-file");a&&(a.value=""),b?(i.value="",i.placeholder="Emoji or letter",r&&o&&(o.src=b,r.classList.add("visible"))):(i.value=t.icon&&!L(t.icon)?t.icon:"",i.maxLength=4,i.placeholder="Emoji or letter",r&&r.classList.remove("visible")),document.getElementById("change-icon-modal").classList.add("open"),document.getElementById("change-icon-emoji-picker").classList.remove("open"),i.focus()}}function oe(){document.getElementById("change-icon-modal").classList.remove("open"),document.getElementById("change-icon-emoji-picker").classList.remove("open"),B=null,b=null;var e=document.getElementById("change-icon-preview-wrap");e&&e.classList.remove("visible")}function ae(){if(B){var t=document.getElementById("change-icon-input"),n=b||(t.value||"").trim()||void 0,i=B;oe(),e.updateServer(i,{icon:n}).then(function(){ze()})}}function ce(){document.getElementById("server-context-menu").classList.remove("open"),I=null}function de(){var e=document.getElementById("admin-token-modal");e&&e.classList.remove("open")}function se(){var t=document.getElementById("admin-token-input"),n=t&&t.value?t.value.trim():"";de(),n&&e.submitAdminToken&&e.submitAdminToken(n,u).catch(function(){})}function le(){m=!0;var t=(v||((v=document.createElement("iframe")).className="communities-frame",v.title="Communities",v.src="communities/test.html",n.appendChild(v),e&&e.getCommunitiesPageUrl&&e.getCommunitiesPageUrl().then(function(e){e&&v&&(v.src=e)})),v);"about:blank"===t.src&&(t.src="communities/test.html",e&&e.getCommunitiesPageUrl&&e.getCommunitiesPageUrl().then(function(e){e&&t&&(t.src=e)})),n.classList.add("communities-active"),J()}_=document.getElementById("admin-token-modal"),ee=document.getElementById("admin-token-input"),te=document.getElementById("admin-token-cancel"),ne=document.getElementById("admin-token-submit"),_&&ee&&te&&ne&&(te.addEventListener("click",de),ne.addEventListener("click",se),ee.addEventListener("keydown",function(e){"Enter"===e.key&&se(),"Escape"===e.key&&de()}),_.addEventListener("click",function(e){e.target===_&&de()})),e.onOpenAdminTokenDialog&&e.onOpenAdminTokenDialog(function(){var e=document.getElementById("admin-token-modal"),t=document.getElementById("admin-token-input");e&&t&&(t.value="",e.classList.add("open"),t.focus())});var ue=null;function me(){ue=null,document.getElementById("add-server-confirm-modal").classList.remove("open")}function ve(){document.getElementById("copy-text-modal").classList.remove("open")}function fe(){var t=ue;me(),t&&e.addServer&&(m=!1,n.classList.remove("communities-active"),v&&(v.remove(),v=null),J(),e.addServer({url:t.url,name:t.name}).then(function(e){s=Array.isArray(e)?e:[];var n=s.find(function(e){return e.url===t.url||f(e.url)===f(t.url)});n?h(n):ze()}))}function pe(){var e=document.getElementById("device-settings-modal");if(e){var t=document.getElementById("sidebar-settings-btn");t&&t.classList.add("active"),qe(),Oe("device-input-test-panel",null),Oe("device-webcam-test-panel",null),e.classList.add("open"),Se()}}function ge(){var e=document.getElementById("sidebar-settings-btn");e&&e.classList.remove("active");var t=document.getElementById("device-settings-modal");t&&t.classList.remove("open"),qe(),c()}function ye(e,t,n,i){var r=document.getElementById(e);if(r){r.innerHTML="";var o=document.createElement("option");o.value="none",o.textContent="None",r.appendChild(o);var a=document.createElement("option");a.value="",a.textContent="Default",r.appendChild(a),t.forEach(function(e){var t=document.createElement("option");t.value=e.deviceId,t.textContent=e.label||e.kind+" "+r.options.length,r.appendChild(t)}),r.value="none"===i?"none":i||""}}var Ee=100,he=null,Le=null;function Ie(e,t,n){var i,r=document.getElementById(e);if(r&&(r.style.left=(i=t,Math.max(0,Math.min(200,i))/200*100+"%"),n)){var o=document.getElementById(n);o&&(o.textContent=t+"%")}}function ke(t,n,i,r,o,a){var c=document.getElementById(t),d=document.getElementById(n);document.getElementById(i);if(c&&d){Ie(n,a.current,r),c.addEventListener("click",function(e){e.target!==d&&l(e)});var s=!1;d.addEventListener("mousedown",function(e){e.preventDefault(),s=!0}),document.addEventListener("mousemove",function(e){s&&l(e)}),document.addEventListener("mouseup",function e(){s&&(s=!1),document.removeEventListener("mousemove",move),document.removeEventListener("mouseup",e)})}function l(t){var i,d=c.getBoundingClientRect(),s=t.clientX-d.left,l=(i=s/d.width*100,Math.round(Math.max(0,Math.min(200,i/100*200))));a.current=l,"audioInputVolume"===o&&(Ee=l),Ie(n,l,r),function(e,t){"audioInputVolume"===e&&he&&(he.gain.value=t/100)}(o,l),function(t,n){e.getDevicePreferences&&e.setDevicePreferences&&e.getDevicePreferences().then(function(i){i[t]=n,e.setDevicePreferences(i),e.requestApplyDevicePreferences&&e.requestApplyDevicePreferences()})}(o,l)}}var Be=!1;function be(){var e=document.getElementById("device-ptt-display");e&&(e.textContent=function(e){if(!e)return"Not set";if(0===e.indexOf("Mouse"))return"Mouse "+e.slice(5);if(0===e.indexOf("Key")){var t=e.slice(3);return t.length,t}return e}(Ae),Ae?e.classList.add("is-set"):e.classList.remove("is-set"))}function Ce(t){Ae=t||void 0,e.getDevicePreferences&&e.setDevicePreferences&&e.getDevicePreferences().then(function(t){t.pttBinding=Ae,e.setDevicePreferences(t)})}function xe(){var e=document.getElementById("device-ptt-set"),t=document.getElementById("device-ptt-display");function n(t){e.classList.remove("listening"),e.textContent="Set key",t?(Ce(t),be()):be(),document.removeEventListener("keydown",i,!0),document.removeEventListener("mousedown",r,!0)}function i(e){if("Escape"===e.key)return e.preventDefault(),void n(null);e.preventDefault(),e.stopPropagation();var t=e.code||(1===e.key.length?"Key"+e.key.toUpperCase():e.key);0===t.indexOf("Key")&&n(t)}function r(e){0!==e.button&&2!==e.button&&(e.preventDefault(),e.stopPropagation(),n("Mouse"+e.button))}e&&t&&(e.classList.add("listening"),e.textContent="Press key or button‚Ä¶",t.textContent="Listening‚Ä¶",document.addEventListener("keydown",i,!0),document.addEventListener("mousedown",r,!0))}var Ae=void 0,we=null;function Se(){e.getDevicePreferences&&navigator.mediaDevices&&e.getDevicePreferences().then(function(e){Ae=e&&e.pttBinding||void 0,we={audioInput:e&&e.audioInput,videoInput:e&&e.videoInput,audioInputVolume:e&&null!=e.audioInputVolume?e.audioInputVolume:100,pttBinding:e&&e.pttBinding},be(),function(e){Ie("device-input-puck",Ee=e&&null!=e.audioInputVolume?e.audioInputVolume:100,"device-input-volume-pct"),Be||(Be=!0,ke("device-input-track","device-input-puck","device-input-fill","device-input-volume-pct","audioInputVolume",{current:Ee}))}(e);var t=document.getElementById("device-input"),n=document.getElementById("device-webcam");function i(t){var n=(t||[]).filter(function(e){return"audioinput"===e.kind}),i=(t||[]).filter(function(e){return"videoinput"===e.kind});ye("device-input",n,0,e&&e.audioInput),ye("device-webcam",i,0,e&&e.videoInput)}t&&n&&navigator.mediaDevices.enumerateDevices().then(function(e){(e||[]).some(function(e){return!e.label})?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(t){t.getTracks().forEach(function(e){e.stop()}),navigator.mediaDevices.enumerateDevices().then(i).catch(function(){i(e)})}).catch(function(){i(e||[])}):i(e||[])}).catch(function(){i([])})})}function De(e){if(e&&e.value&&"none"!==e.value&&e.options&&e.options[e.selectedIndex]){var t=e.options[e.selectedIndex].textContent;return t&&t.trim()||void 0}}var Me=null,Te=null,Pe=null,Ne=null;function qe(){Me&&(Me.getTracks().forEach(function(e){e.stop()}),Me=null),Te&&Te.srcObject&&(Te.srcObject.getTracks().forEach(function(e){e.stop()}),Te.srcObject=null),Pe&&(Pe.close().catch(function(){}),Pe=null),Ne&&(cancelAnimationFrame(Ne),Ne=null),he=null;var e=document.getElementById("device-input-fill");e&&(e.style.display="none",e.style.width="0"),Le&&(Le.textContent="Test",Le.classList.remove("device-test-btn-stop"),Le=null)}function Oe(e,t){var n=document.getElementById(e);n&&(n.innerHTML="",t&&t.nodeType&&n.appendChild(t))}var Ue=-60;function Re(e,t){var n=(e-Ue)/60;return Math.max(0,Math.min(t,n*t))}function je(){var e=document.getElementById("device-input-test"),t=document.getElementById("device-input"),n="device-input-test-panel",i=document.getElementById("device-input-fill");if(t&&navigator.mediaDevices){if(Le===e)return qe(),void Oe(n,null);if(qe(),"none"!==t.value&&""!==t.value){var r,o={audio:!t.value||{deviceId:{exact:t.value}}};navigator.mediaDevices.getUserMedia(o).then(function(t){Me=t;var r=document.getElementById(n);if(r){r.innerHTML="",i&&(i.style.display="block",i.style.width="0",i.style.backgroundColor="#3b82f6"),e&&(Le=e,e.textContent="Stop",e.classList.add("device-test-btn-stop"));var o=new(window.AudioContext||window.webkitAudioContext);Pe=o;var a=o.createMediaStreamSource(t),c=o.createGain();c.gain.value=Ee/100,he=c;var d=o.createAnalyser();d.fftSize=256,d.smoothingTimeConstant=.8,a.connect(c),c.connect(d);var s=new Uint8Array(d.frequencyBinCount),l=document.getElementById("device-input-track");!function e(){if(Me){d.getByteFrequencyData(s);for(var t=0,n=0;n<s.length;n++)t+=s[n];var r,o=t/s.length/255,a=(r=o)<=0?Ue:Math.max(Ue,20*Math.log10(r));if(i&&l){var c=l.getBoundingClientRect().width;i.style.width=Re(a,c)+"px"}Ne=requestAnimationFrame(e)}}()}}).catch(function(e){Oe(n,function(){var t=document.createElement("p");return t.className="device-test-msg",t.textContent="Could not access device: "+(e.message||e.name||"Unknown error"),t}())})}else Oe(n,((r=document.createElement("p")).className="device-test-msg",r.textContent="none"===t.value?"None selected ‚Äî no device to test.":"Select a device to test.",r))}}function He(){var e=document.getElementById("device-webcam-test"),t=document.getElementById("device-webcam"),n="device-webcam-test-panel";if(t&&navigator.mediaDevices){if(Le===e)return qe(),void Oe(n,null);if(qe(),"none"!==t.value&&""!==t.value){var i,r={video:!t.value||{deviceId:{exact:t.value}}};navigator.mediaDevices.getUserMedia(r).then(function(t){Me=t;var i=document.getElementById(n);if(i){i.innerHTML="",e&&(Le=e,e.textContent="Stop",e.classList.add("device-test-btn-stop"));var r=document.createElement("video");r.autoplay=!0,r.muted=!0,r.playsInline=!0,r.srcObject=t,Te=r,i.appendChild(r)}}).catch(function(e){Oe(n,function(){var t=document.createElement("p");return t.className="device-test-msg",t.textContent="Could not access camera: "+(e.message||e.name||"Unknown error"),t}())})}else Oe(n,((i=document.createElement("p")).className="device-test-msg",i.textContent="none"===t.value?"None selected ‚Äî no device to test.":"Select a device to test.",i))}}function Ve(){if(e.setDevicePreferences){qe(),Ae=void 0;var t={audioInput:void 0,videoInput:void 0,audioInputLabel:void 0,videoInputLabel:void 0,audioInputVolume:100,pttBinding:void 0};e.setDevicePreferences(t),e.requestApplyDevicePreferences&&e.requestApplyDevicePreferences(),Se()}}function Fe(){if(e.setDevicePreferences){var t=document.getElementById("device-input"),n=document.getElementById("device-webcam"),i={audioInput:t&&t.value||void 0,videoInput:n&&n.value||void 0,audioInputLabel:De(t),videoInputLabel:De(n),audioInputVolume:Ee,pttBinding:Ae},r=function(){if(!we)return!1;var e=document.getElementById("device-input"),t=document.getElementById("device-webcam"),n=e&&e.value||void 0,i=t&&t.value||void 0,r=Ee,o=Ae;return n!==we.audioInput||i!==we.videoInput||r!==we.audioInputVolume||o!==we.pttBinding}();if(ge(),e.setDevicePreferences(i),e.requestApplyDevicePreferences&&e.requestApplyDevicePreferences(),r){var o=document.getElementById("reconnect-modal");o&&o.classList.add("open")}}}function ze(){e.getServers().then(function(t){s=Array.isArray(t)?t:[];var n=u;0===s.length?(u=null,l="https://demo.sharkord.com",e.setServerUrl(l)):n&&s.find(function(e){return e.id===n})||(u=s[0].id,l=s[0].url,e.setServerUrl(s[0].url)),E(),J()})}!function(){var e=document.getElementById("device-settings-modal"),t=document.getElementById("device-settings-reset"),n=document.getElementById("device-settings-cancel"),i=document.getElementById("device-settings-save");if(e&&n&&i){t&&t.addEventListener("click",Ve),n.addEventListener("click",ge),i.addEventListener("click",Fe);var r=document.getElementById("device-ptt-set"),o=document.getElementById("device-ptt-reset");r&&r.addEventListener("click",xe),o&&o.addEventListener("click",function(){Ce(void 0),be()});var a=document.getElementById("device-input-test"),c=document.getElementById("device-webcam-test");a&&a.addEventListener("click",je),c&&c.addEventListener("click",He),e.addEventListener("click",function(t){t.target===e&&ge()}),document.addEventListener("keydown",function(t){"Escape"===t.key&&e.classList.contains("open")&&ge()})}}(),function(){var t=document.getElementById("add-server-modal"),n=document.getElementById("add-server-input"),i=document.getElementById("add-server-cancel"),r=document.getElementById("add-server-add");i.addEventListener("click",Z),r.addEventListener("click",$),n.addEventListener("keydown",function(e){"Enter"===e.key&&$(),"Escape"===e.key&&Z()}),t.addEventListener("click",function(e){e.target===t&&Z()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("open")&&Z()}),e.onOpenAddServerModal&&e.onOpenAddServerModal(Q)}(),function(){var t=document.getElementById("about-modal"),n=document.getElementById("about-close");function i(){t.classList.remove("open")}t&&n&&(n.addEventListener("click",i),t.addEventListener("click",function(e){e.target===t&&i()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("open")&&i()}),e.onOpenAboutModal&&e.onOpenAboutModal(function(){e.getAppVersion().then(function(e){var n=document.getElementById("about-version");n&&(n.textContent=e?"Version "+e:""),t.classList.add("open")})}))}(),function(){var e=document.getElementById("add-server-confirm-modal"),t=document.getElementById("add-server-confirm-cancel"),n=document.getElementById("add-server-confirm-add");e&&t&&n&&(t.addEventListener("click",me),n.addEventListener("click",fe),e.addEventListener("click",function(t){t.target===e&&me()}),document.addEventListener("keydown",function(t){"Escape"===t.key&&e.classList.contains("open")&&me()}))}(),function(){var t=document.getElementById("copy-text-modal"),n=document.getElementById("copy-text-close"),i=document.getElementById("copy-text-copy"),r=document.getElementById("copy-text-input");t&&n&&i&&r&&(n.addEventListener("click",ve),i.addEventListener("click",function(){var t=r.value;t&&e&&e.copyToClipboard&&e.copyToClipboard(t),ve()}),t.addEventListener("click",function(e){e.target===t&&ve()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("open")&&ve()}))}(),function(){var t=document.getElementById("clear-servers-modal"),n=document.getElementById("clear-servers-cancel"),i=document.getElementById("clear-servers-confirm");function r(){t.classList.remove("open")}t&&n&&i&&(n.addEventListener("click",r),i.addEventListener("click",function(){e&&e.confirmClearServers&&e.confirmClearServers(),r()}),t.addEventListener("click",function(e){e.target===t&&r()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("open")&&r()}),e&&e.onOpenClearServersModal&&e.onOpenClearServersModal(function(){t.classList.add("open")}))}(),function(){var t=document.getElementById("remove-server-modal"),n=document.getElementById("remove-server-cancel"),i=document.getElementById("remove-server-confirm");function r(){t.classList.remove("open"),k=null}t&&n&&i&&(n.addEventListener("click",r),i.addEventListener("click",function(){var t=k;r(),t&&e&&e.removeServer&&(e.removeServer(t),ze())}),t.addEventListener("click",function(e){e.target===t&&r()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("open")&&r()}))}(),function(){var t=document.getElementById("reconnect-modal"),i=document.getElementById("reconnect-cancel"),r=document.getElementById("reconnect-confirm");function o(){t.classList.remove("open")}t&&i&&r&&(i.addEventListener("click",o),r.addEventListener("click",function(){if(o(),e.reloadForReconnect)e.reloadForReconnect();else{var t=g();if(t&&t.url&&n){var i=n.querySelector('.client-frame[data-server-id="'+t.id+'"]');i&&(i.src=t.url)}}}),t.addEventListener("click",function(e){e.target===t&&o()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("open")&&o()}))}(),function(){var e=document.getElementById("change-icon-modal"),t=document.getElementById("change-icon-input"),n=document.getElementById("change-icon-emoji-btn"),i=document.getElementById("change-icon-emoji-picker"),r=document.getElementById("change-icon-image-btn"),o=document.getElementById("change-icon-file"),a=document.getElementById("change-icon-preview-wrap"),c=document.getElementById("change-icon-preview"),d=document.getElementById("change-icon-clear-image");document.getElementById("change-icon-cancel").addEventListener("click",oe),document.getElementById("change-icon-save").addEventListener("click",ae),r&&o&&(r.addEventListener("click",function(){o.click()}),o.addEventListener("change",function(){var e=o.files&&o.files[0];if(e&&e.type.startsWith("image/")){var n=new FileReader;n.onload=function(){b=n.result,a&&c&&(c.src=b,a.classList.add("visible")),t.value=""},n.readAsDataURL(e),o.value=""}})),d&&a&&d.addEventListener("click",function(){b=null,a.classList.remove("visible"),c&&c.removeAttribute("src"),t.placeholder="Emoji or letter",t.focus()}),n.addEventListener("click",function(e){e.stopPropagation(),i.classList.toggle("open")}),document.addEventListener("click",function(){i.classList.remove("open")}),i.addEventListener("click",function(e){e.stopPropagation()}),t.addEventListener("keydown",function(e){"Enter"===e.key&&ae(),"Escape"===e.key&&oe()}),e.addEventListener("click",function(t){t.target===e&&oe()})}(),function(){document.getElementById("server-context-menu");document.getElementById("context-change-icon").addEventListener("click",function(){var e=I;ce(),e&&re(e)}),document.getElementById("context-keep-connected").addEventListener("click",function(){var t=I;if(ce(),t){var n=s.find(function(e){return e.id===t});n&&e.updateServer(t,{keepConnected:!n.keepConnected}).then(function(e){Array.isArray(e)?(s=e,E(),J()):ze()})}}),document.getElementById("context-remove").addEventListener("click",function(){var e=I;if(ce(),e){var t=s.find(function(t){return t.id===e});if(t){var n=document.getElementById("remove-server-confirm-text");n&&(n.textContent='Remove "'+(t.name||"Server")+'" from list?'),k=e;var i=document.getElementById("remove-server-modal");i&&i.classList.add("open")}}}),document.addEventListener("click",ce)}(),(e.getServerUrl?e.getServerUrl():Promise.resolve("https://demo.sharkord.com")).then(function(t){l=t||"https://demo.sharkord.com",e.getServers().then(function(t){if(s=Array.isArray(t)?t:[],s.length>0){var n=s.find(function(e){return f(e.url)===f(l)});n?(u=n.id,l=n.url):(u=s[0].id,l=s[0].url,e.setServerUrl(s[0].url))}else u=null;E(),J()})}),e.onNavigate&&e.onNavigate(function(e){l=e;var n=s.find(function(t){return f(t.url)===f(e)});n?(u=n.id,E()):E(),J(),function(){if(null!==x){var e=t.querySelector('.server-btn[data-server-id="'+x+'"]');if(e){x=null;var n=document.createElement("span");n.className="ripple",e.insertBefore(n,e.firstChild),n.animate([{transform:"translate(-50%, -50%) scale(0)"},{transform:"translate(-50%, -50%) scale(2)"}],{duration:1e3,easing:"ease-out",fill:"forwards"}).onfinish=function(){e.style.transition="none",e.style.background="#3b82f6",n.style.opacity="0",n.style.pointerEvents="none",e.offsetHeight,setTimeout(function(){n.parentNode&&n.parentNode.removeChild(n),e.classList.remove("ripple-pending"),e.classList.add("active"),e.style.transition=""},120)}}}}()})}();