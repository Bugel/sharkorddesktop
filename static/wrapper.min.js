!function(){const e=window.sharkordDesktop,t=document.getElementById("sidebar"),n=document.getElementById("client-container");var i="camera; microphone; display-capture";window.addEventListener("message",function(t){if(t.data)if("sharkord-ptt"===t.data.type&&"boolean"==typeof t.data.pressed&&e&&e.pttState)e.pttState(t.data.pressed);else if("sharkord-add-server"===t.data.type&&t.data.url)!function(t){var n=t.url,i=t.name||(n?function(){try{return new URL(n).hostname}catch(e){return"Server"}}():"Server");if(!n||!e.addServer)return;!function(e,t){Ee={url:e,name:t};var n=document.getElementById("add-server-confirm-text");n&&(n.textContent='Would you like to add "'+t+'" ('+e+") to your server panel?");document.getElementById("add-server-confirm-modal").classList.add("open")}(n.startsWith("http://")||n.startsWith("https://")?n:"https://"+n,i)}(t.data);else if("sharkord-request-communities-db"===t.data.type&&t.data.url&&e&&e.fetchCommunitiesDatabase&&t.source)e.fetchCommunitiesDatabase(t.data.url).then(function(e){try{t.source.postMessage({type:"sharkord-communities-db-response",data:e,lastRefreshed:(new Date).toISOString()},"*")}catch(e){}}).catch(function(){try{t.source.postMessage({type:"sharkord-communities-db-response",data:null},"*")}catch(e){}});else if("sharkord-refresh-communities"===t.data.type&&e&&e.refreshCommunitiesCache&&v)v.src="about:blank",setTimeout(function(){e.refreshCommunitiesCache().then(function(t){t&&e.getCommunitiesPageUrl&&v?e.getCommunitiesPageUrl().then(function(e){e&&v&&(v.src=e)}):v&&(v.src="communities/test.html")})},100);else if("sharkord-copy-to-clipboard"===t.data.type&&"string"==typeof t.data.text)!function(e){var t=document.getElementById("copy-text-input"),n=document.getElementById("copy-text-modal");t&&(t.value=e||"");n&&n.classList.add("open");t&&(t.focus(),t.select())}(t.data.text);else if("sharkord-iframe-contextmenu"===t.data.type&&"string"==typeof t.data.url){var n=document.getElementById("iframe-context-menu"),i=document.querySelector(".client-frame.active");if(n&&i){fe();var o=i.getBoundingClientRect(),r=o.left+(t.data.clientX||0),a=o.top+(t.data.clientY||0);t.data.url,B=("string"==typeof t.data.copyText?t.data.copyText:"")||("string"==typeof t.data.selectedText?t.data.selectedText:""),b="string"==typeof t.data.imageUrl&&t.data.imageUrl?t.data.imageUrl:null,x=i;var c=document.getElementById("iframe-ctx-download-image");c&&(b?c.classList.remove("context-menu-item-hidden"):c.classList.add("context-menu-item-hidden")),ue(n,r,a),me()}}});var o=null,r=null,a=null;function c(){e&&e.getDevicePreferences&&e.pttState&&(r&&(document.removeEventListener("keydown",r,!0),document.removeEventListener("keyup",a,!0),r=a=null),o=null,e.getDevicePreferences().then(function(t){var n=t&&t.pttBinding;n&&0===String(n).indexOf("Key")&&(o=n,r=function(t){t.code===o&&(t.preventDefault(),t.stopPropagation(),e.pttState(!0))},a=function(t){t.code===o&&(t.preventDefault(),t.stopPropagation(),e.pttState(!1))},document.addEventListener("keydown",r,!0),document.addEventListener("keyup",a,!0))}))}if(e&&c(),!e||!e.getServers||!e.getServerUrl){var d=document.createElement("iframe");return d.className="client-frame active",d.title="Sharkord",d.allow=i,d.setAttribute("tabindex","0"),d.src="https://demo.sharkord.com",void n.appendChild(d)}let s=[],l="";var u=null,m=!1,v=null;function f(e){try{return new URL(e).origin}catch{return e}}function p(e){return e.id===u}function g(){return u?s.find(function(e){return e.id===u}):null}function y(t){t.addEventListener("load",function(){if(t.classList.contains("active")&&(t.setAttribute("tabindex","0"),t.focus(),e.focusActiveClientFrame)){var n=g(),i=n&&n.url?n.url:t.src||"";setTimeout(function(){e.focusActiveClientFrame(i)},50)}})}function h(){if(0===s.length){n.querySelectorAll(".client-frame").forEach(function(e){e.remove()}),(a=n.querySelector(".empty-state"))&&a.remove();var e=document.createElement("div");return e.className="empty-state",e.textContent="There are no saved servers to connect to! Join a community using the plus icon located on the bottom of the server panel!",void n.appendChild(e)}var t=n.querySelector(".empty-state");t&&t.remove();var o=function(){if(0===s.length)return[];if(!g())return[];var e=s.filter(function(e){return e.id===u||e.keepConnected}).map(function(e){return e.id});return 0!==e.indexOf(u)&&(e=e.filter(function(e){return e!==u})).unshift(u),e}(),r=Array.from(n.querySelectorAll(".client-frame")).filter(function(e){return e.dataset.serverId});if(0===o.length){var a,c=g();n.querySelectorAll(".client-frame").forEach(function(e){e.remove()}),(a=n.querySelector(".empty-state"))&&a.remove();var d=document.createElement("iframe");return d.className="client-frame active",d.title="Sharkord",d.allow=i,d.setAttribute("tabindex","0"),y(d),d.src=c?c.url:l,void n.appendChild(d)}var m={};o.forEach(function(e){m[e]=!0}),r.forEach(function(e){var t=e.dataset.serverId;m[t]||e.remove()}),o.forEach(function(e){var t=n.querySelector('.client-frame[data-server-id="'+e+'"]');if(t)t.classList.toggle("active",e===u);else{var o=s.find(function(t){return t.id===e});if(o){var r=document.createElement("iframe");r.className="client-frame"+(e===u?" active":""),r.title=o.name,r.allow=i,r.setAttribute("tabindex","0"),r.dataset.serverId=o.id,y(r),r.src=o.url,n.appendChild(r)}}}),n.querySelectorAll(".client-frame").forEach(function(e){e.classList.toggle("active",e.dataset.serverId===u)})}function E(e){e&&(e.classList.add("frame-fade-in"),requestAnimationFrame(function(){requestAnimationFrame(function(){e.classList.remove("frame-fade-in")})}))}function L(t){m=!1,n.classList.remove("communities-active"),l=t.url,u=t.id,M=t.id,e.setServerUrl(t.url);var i=n.querySelector('.client-frame[data-server-id="'+t.id+'"]');i?(n.querySelectorAll(".client-frame").forEach(function(e){e.classList.toggle("active",e.dataset.serverId===t.id)}),E(i)):(h(),E(i=n.querySelector('.client-frame[data-server-id="'+t.id+'"]'))),_()}function I(e){return"string"==typeof e&&0===e.indexOf("data:image/")}let k=null;var B="",b=null,x=null,C=null,w=null,A=null,S=!1,M=null,T=null,D=null,O=!1,P=null,N=null,q=80;function U(){document.querySelectorAll(".server-btn-drag-clone").forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)})}function G(e,n){if(P){var i=t.getBoundingClientRect().top+W+22,o=Math.max(n,i);P.style.left=e+"px",P.style.top=o+"px"}}function R(e,t){return{x:e.left+e.width/2,y:e.top+W+t*z+22}}function H(e,t,n){if(t.length&&1!==t.length){e.style.transition="left "+q/1e3+"s ease-out, top "+q/1e3+"s ease-out";var i=0;requestAnimationFrame(function(){o()})}else n&&n();function o(){if(++i>=t.length)n&&n();else{var r=t[i];e.style.left=r.x+"px",e.style.top=r.y+"px";var a=!1;e.addEventListener("transitionend",c),setTimeout(function(){a||c()},q+30)}function c(){a||(a=!0,e.removeEventListener("transitionend",c),o())}}}var j=250;function V(e,t){e&&e.dataset.serverId!==T&&(e.classList.remove("nudge-down","nudge-up"),e.offsetWidth,e.classList.add(t),setTimeout(function(){e.classList.remove("nudge-down","nudge-up")},j))}function F(e,n){if(e){var i=[];t.querySelectorAll(".server-btn").forEach(function(t){var n=t.dataset.serverId;if(n){var o=e.indexOf(n);t.style.order=String(o>=0?o:999),o>=0&&(i[o]=t)}}),n&&i.forEach(function(e,t){if(e){var o=e.dataset.serverId;if(o!==T){var r=n.indexOf(o);if(-1!==r&&r!==t){var a=t>r?"nudge-down":"nudge-up";V(e,a);var c=t-1;c>=0&&i[c]&&V(i[c],a)}}}})}}var W=8,z=48;function X(e,n){if(n<=0)return 0;var i=t.getBoundingClientRect().top+W;return e<=i?0:e>=i+n*z?n-1:Math.min(n-1,Math.max(0,Math.floor((e-i)/z)))}function K(e,n){if(T&&D&&0!==D.length){D.length;var i=function(e,n,i){if(!i||0===i.length)return 0;var o=Array.from(t.querySelectorAll(".server-btn")).filter(function(e){return e.dataset.serverId&&!e.classList.contains("dragging")});if(0===o.length)return X(n,i.length);o.sort(function(e,t){return e.getBoundingClientRect().top-t.getBoundingClientRect().top});for(var r=0;r<o.length;r++){var a=o[r].getBoundingClientRect();if(n>=a.top&&n<=a.bottom&&e>=a.left&&e<=a.right){var c=o[r].dataset.serverId,d=i.indexOf(c);return d>=0?d:X(n,i.length)}}return X(n,i.length)}(e,n,D),o=T,r=D.indexOf(o);if(-1!==r&&r!==i){var a=D.slice();D.splice(r,1),D.splice(i,0,o),F(D,a)}}}var Y=null,J=null,Q=null,Z=null;function $(){var e=Y;if(e&&J&&Q){var t=e.scrollTop>0,n=e.scrollTop+e.clientHeight<e.scrollHeight;J.classList.toggle("visible",t),Q.classList.toggle("visible",n)}}function _(){Z&&Y&&(Z.disconnect(),Z=null),t.innerHTML="",Y=null,J=null,Q=null;var n=document.createElement("div");n.className="sidebar-scroll-arrow",n.setAttribute("aria-hidden","true"),n.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>';var i=document.createElement("div");i.className="sidebar-scroll-viewport";var o=document.createElement("div");o.className="sidebar-scroll-arrow",o.setAttribute("aria-hidden","true"),o.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>',J=n,Y=i,Q=o;var r=document.createElement("div");r.className="sidebar-scroll-region",r.appendChild(n),r.appendChild(i),r.appendChild(o),t.appendChild(r),s.forEach(function(n){const o=document.createElement("button");o.type="button",o.draggable=!0,o.dataset.serverId=n.id;var r=function(e){return e.icon&&e.icon.trim()?e.icon.trim():(e.name||"?").charAt(0).toUpperCase()}(n),a=I(r),c=!a&&(r.length>1||1===r.length&&r.charCodeAt(0)>127),d=p(n)&&M===n.id;o.className="server-btn"+(d?" ripple-pending":p(n)?" active":"")+(c?" icon-emoji":"")+(a?" icon-image":"");var l=[];if(n.identity&&l.push("saved login"),n.keepConnected&&l.push("keep connected"),o.title=n.name+(l.length?" ("+l.join(", ")+")":"")+" â€” drag to reorder",a){var v=document.createElement("img");v.src=r,v.alt=n.name||"",v.className="server-btn-icon-img",o.appendChild(v)}else{var f=document.createElement("span");f.className="server-btn-icon",f.textContent=r,o.appendChild(f)}o.addEventListener("click",function(){S?S=!1:(n.id!==u||m)&&L(n)});var g=null;o.addEventListener("dragstart",function(e){T=n.id,D=s.map(function(e){return e.id}),O=!1,t.classList.add("reordering"),document.body.classList.add("sharkord-dragging"),e.dataTransfer.setData("text/plain",n.id),e.dataTransfer.effectAllowed="move",e.dataTransfer.setDragImage((N||((N=new Image).src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"),N),0,0),F(D),o.classList.add("dragging"),U();var i=o.cloneNode(!0);i.classList.add("server-btn-drag-clone"),i.setAttribute("aria-hidden","true"),i.style.left=e.clientX+"px",i.style.top=e.clientY+"px",document.body.appendChild(i),P=i,g=function(e){e.preventDefault(),e.dataTransfer.dropEffect="move",K(e.clientX,e.clientY),G(e.clientX,e.clientY)},document.addEventListener("dragover",g,!0)}),o.addEventListener("dragend",function(){function n(){T&&(document.body.classList.remove("sharkord-dragging"),P&&P.parentNode&&P.parentNode.removeChild(P),P=null,U(),!O&&D&&D.length&&e.reorderServers&&e.reorderServers(D.slice()).then(function(e){s=Array.isArray(e)?e:s,_()}),T=null,D=null,O=!1,t.classList.remove("reordering"),o.classList.remove("dragging"),t.querySelectorAll(".server-btn").forEach(function(e){e.classList.remove("drag-over")}),t.querySelectorAll(".server-btn").forEach(function(e){e.style.order=""}),S=!0,setTimeout(function(){S=!1},200))}if(g&&(document.removeEventListener("dragover",g,!0),g=null),setTimeout(function(){document.querySelector(".server-btn-drag-clone")&&(U(),n())},3e3),P&&D&&T&&!O){var i=t.getBoundingClientRect(),r=D.length,a=P.getBoundingClientRect(),c=a.top+22,d=a.left+22,l=X(c,r),u=D.indexOf(T);if(u<0&&(u=0),l!==u&&!(0===u&&l===r-1)&&!(u===r-1&&0===l)){var m=D.slice(),v=D.indexOf(T);-1!==v&&(D.splice(v,1),D.splice(l,0,T),F(D,m)),u=l}var f,p=X(c,r),y=[{x:d,y:c}];if(p<u)for(f=p+1;f<=u;f++)y.push(R(i,f));else if(p>u)for(f=p-1;f>=u;f--)y.push(R(i,f));else y.push(R(i,u));H(P,y,n),setTimeout(function(){P&&P.parentNode&&n()},2500)}else n()}),o.addEventListener("dragover",function(e){e.preventDefault(),e.dataTransfer.dropEffect="move",G(e.clientX,e.clientY);var t=T;if(t&&t!==n.id){o.classList.add("drag-over");var i=D?D.slice():s.map(function(e){return e.id}),r=i.indexOf(t),a=i.indexOf(n.id);if(-1!==r&&-1!==a){var c=i.slice();i.splice(r,1),i.splice(a,0,t),F(D=i,c)}}}),o.addEventListener("dragleave",function(){o.classList.remove("drag-over")}),o.addEventListener("drop",function(t){if(t.preventDefault(),o.classList.remove("drag-over"),(T||t.dataTransfer.getData("text/plain"))&&e.reorderServers){O=!0;var n=D&&D.length?D.slice():s.map(function(e){return e.id});e.reorderServers(n).then(function(e){s=Array.isArray(e)?e:s,_()})}}),o.addEventListener("contextmenu",function(e){e.preventDefault(),k=n.id;var t=document.getElementById("server-context-menu"),i=document.getElementById("context-keep-connected");i&&(i.textContent=n.keepConnected?"Keep connected âœ“":"Keep connected"),pe(),ue(t,e.clientX,e.clientY),me()}),i.appendChild(o)}),i.addEventListener("scroll",$),"undefined"!=typeof ResizeObserver&&(Z=new ResizeObserver(function(){$()})).observe(i),requestAnimationFrame(function(){$()});var a=document.createElement("div");a.className="sidebar-footer-actions";var c=document.createElement("div");c.className="drag-trash-btn",c.setAttribute("aria-hidden","true"),c.title="Remove from list (drag server here)",c.innerHTML='<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>',c.addEventListener("dragover",function(e){e.preventDefault(),e.dataTransfer.dropEffect="move",c.classList.add("drag-over-trash")}),c.addEventListener("dragleave",function(){c.classList.remove("drag-over-trash")}),c.addEventListener("drop",function(t){t.preventDefault(),c.classList.remove("drag-over-trash");var n=T||t.dataTransfer.getData("text/plain");n&&e.removeServer&&(O=!0,e.removeServer(n),ct())}),a.appendChild(c);var d=document.createElement("button");d.type="button",d.className="communities-btn"+(m?" active":""),d.title="Communities",d.innerHTML='<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 4.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5z"/><path d="M7 7a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/><path d="M17 7a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/><path d="M12 12c-1.5 0-3 .8-3 2v2h6v-2c0-1.2-1.5-2-3-2z"/><path d="M7 14c-1 0-2 .5-2 1.5v1.5h4v-1.5c0-1-.5-1.5-2-1.5z"/><path d="M17 14c-1 0-2 .5-2 1.5v1.5h4v-1.5c0-1-.5-1.5-2-1.5z"/></svg>',d.addEventListener("click",he),a.appendChild(d);var l=document.createElement("button");l.type="button",l.id="sidebar-settings-btn",l.className="settings-btn",l.title="Media devices (microphone, speaker, camera)",l.textContent="âš™",l.addEventListener("click",Be),a.appendChild(l);var v=document.createElement("button");v.type="button",v.className="add-btn",v.title="Add server",v.textContent="+",v.addEventListener("click",ee),a.appendChild(v),t.appendChild(a)}function ee(){var e=document.getElementById("add-server-modal"),t=document.getElementById("add-server-input");t.value="",e.classList.add("open"),t.focus()}function te(){document.getElementById("add-server-modal").classList.remove("open")}function ne(){var t=function(e){var t=(e||"").trim();return t?t.startsWith("http://")||t.startsWith("https://")?t:"https://"+t:null}((document.getElementById("add-server-input").value||"").trim());if(t){try{var n=new URL(t).hostname}catch(e){return}te(),e.addServer({url:t,name:n}).then(function(e){s=Array.isArray(e)?e:[];var n=s.find(function(e){return f(e.url)===f(t)});n?L(n):ct()})}}var ie,oe,re,ae,ce=["ðŸŸ","ðŸ¦ˆ","ðŸ³","ðŸ”µ","ðŸŸ¢","ðŸŸ¡","ðŸŸ ","ðŸ”´","ðŸ’œ","ðŸŸ£","ðŸ ","â­","ðŸŒ™","â˜€ï¸","ðŸŽ®","ðŸ’¬","ðŸ“","ðŸ”’","ðŸŽµ","ðŸŽ¤","ðŸ“·","ðŸš€","â¤ï¸","âœ¨","ðŸ”¥","ðŸ’¡","ðŸŽ¯","ðŸŒŸ","ðŸŽ¨","ðŸ“Œ","ðŸŒˆ","âš¡","ðŸ†","ðŸŽª","ðŸŽ­","ðŸ˜€","ðŸ‘","ðŸŽ‰","ðŸ””","ðŸ“¬","ðŸŒ","ðŸ›¡ï¸","âš™ï¸","ðŸ”§"];function de(e){var t=s.find(function(t){return t.id===e});if(t){var n;w=e,A=I(t.icon)?t.icon:null,(n=document.getElementById("change-icon-emoji-grid")).innerHTML||ce.forEach(function(e){var t=document.createElement("span");t.textContent=e,t.title=e,t.addEventListener("click",function(){A=null;var t=document.getElementById("change-icon-preview-wrap");t&&t.classList.remove("visible"),document.getElementById("change-icon-input").value=e,document.getElementById("change-icon-emoji-picker").classList.remove("open")}),n.appendChild(t)});var i=document.getElementById("change-icon-input"),o=document.getElementById("change-icon-preview-wrap"),r=document.getElementById("change-icon-preview"),a=document.getElementById("change-icon-file");a&&(a.value=""),A?(i.value="",i.placeholder="Emoji or letter",o&&r&&(r.src=A,o.classList.add("visible"))):(i.value=t.icon&&!I(t.icon)?t.icon:"",i.maxLength=4,i.placeholder="Emoji or letter",o&&o.classList.remove("visible")),document.getElementById("change-icon-modal").classList.add("open"),document.getElementById("change-icon-emoji-picker").classList.remove("open"),i.focus()}}function se(){document.getElementById("change-icon-modal").classList.remove("open"),document.getElementById("change-icon-emoji-picker").classList.remove("open"),w=null,A=null;var e=document.getElementById("change-icon-preview-wrap");e&&e.classList.remove("visible")}function le(){if(w){var t=document.getElementById("change-icon-input"),n=A||(t.value||"").trim()||void 0,i=w;se(),e.updateServer(i,{icon:n}).then(function(){ct()})}}function ue(e,t,n){e.style.left=t+"px",e.style.top=n+"px",e.classList.add("open"),requestAnimationFrame(function(){var t=e.getBoundingClientRect(),n=window.innerWidth,i=window.innerHeight;t.right>n-8&&(e.style.left=n-t.width-8+"px"),t.bottom>i-8&&(e.style.top=i-t.height-8+"px")})}function me(){var e=document.getElementById("context-menu-backdrop");e&&e.classList.add("open")}function ve(){var e=document.getElementById("context-menu-backdrop");e&&e.classList.remove("open")}function fe(){document.getElementById("server-context-menu").classList.remove("open"),k=null,document.getElementById("iframe-context-menu").classList.contains("open")||ve()}function pe(){var e=document.getElementById("iframe-context-menu");e&&e.classList.remove("open"),B="",b=null,x=null,document.getElementById("server-context-menu").classList.contains("open")||ve()}function ge(){var e=document.getElementById("admin-token-modal");e&&e.classList.remove("open")}function ye(){var t=document.getElementById("admin-token-input"),n=t&&t.value?t.value.trim():"";ge(),n&&e.submitAdminToken&&e.submitAdminToken(n,u).catch(function(){})}function he(){m=!0;var t=(v||((v=document.createElement("iframe")).className="communities-frame",v.title="Communities",v.src="communities/test.html",n.appendChild(v),e&&e.getCommunitiesPageUrl&&e.getCommunitiesPageUrl().then(function(e){e&&v&&(v.src=e)})),v);"about:blank"===t.src&&(t.src="communities/test.html",e&&e.getCommunitiesPageUrl&&e.getCommunitiesPageUrl().then(function(e){e&&t&&(t.src=e)})),n.classList.add("communities-active"),E(t),_()}ie=document.getElementById("admin-token-modal"),oe=document.getElementById("admin-token-input"),re=document.getElementById("admin-token-cancel"),ae=document.getElementById("admin-token-submit"),ie&&oe&&re&&ae&&(re.addEventListener("click",ge),ae.addEventListener("click",ye),oe.addEventListener("keydown",function(e){"Enter"===e.key&&ye(),"Escape"===e.key&&ge()}),ie.addEventListener("click",function(e){e.target===ie&&ge()})),e.onOpenAdminTokenDialog&&e.onOpenAdminTokenDialog(function(){var e=document.getElementById("admin-token-modal"),t=document.getElementById("admin-token-input");e&&t&&(t.value="",e.classList.add("open"),t.focus())});var Ee=null;function Le(){Ee=null,document.getElementById("add-server-confirm-modal").classList.remove("open")}function Ie(){document.getElementById("copy-text-modal").classList.remove("open")}function ke(){var t=Ee;Le(),t&&e.addServer&&(m=!1,n.classList.remove("communities-active"),v&&(v.remove(),v=null),_(),e.addServer({url:t.url,name:t.name}).then(function(e){s=Array.isArray(e)?e:[];var n=s.find(function(e){return e.url===t.url||f(e.url)===f(t.url)});n?L(n):ct()}))}function Be(){var e=document.getElementById("device-settings-modal");if(e){var t=document.getElementById("sidebar-settings-btn");t&&t.classList.add("active"),Je(),Qe("device-input-test-panel",null),Qe("device-webcam-test-panel",null),e.classList.add("open"),Fe()}}function be(){var e=document.getElementById("sidebar-settings-btn");e&&e.classList.remove("active");var t=document.getElementById("device-settings-modal");t&&t.classList.remove("open"),Je(),c()}function xe(e,t,n,i){var o=document.getElementById(e);if(o){o.innerHTML="";var r=document.createElement("option");r.value="none",r.textContent="None",o.appendChild(r);var a=document.createElement("option");a.value="",a.textContent="Default",o.appendChild(a),t.forEach(function(e){var t=document.createElement("option");t.value=e.deviceId,t.textContent=e.label||e.kind+" "+o.options.length,o.appendChild(t)}),o.value="none"===i?"none":i||""}}var Ce=100,we=-50,Ae=-60,Se=50,Me=null,Te=null;function De(e,t,n){var i,o=document.getElementById(e);if(o&&(o.style.left=(i=t,Math.max(0,Math.min(200,i))/200*100+"%"),n)){var r=document.getElementById(n);r&&(r.textContent=t+"%")}}function Oe(e,t,n,i,o,r){var a=document.getElementById(e);if(a&&(a.style.left=function(e,t,n){return n===t?50:Math.max(0,Math.min(100,(e-t)/(n-t)*100))}(n,i,o)+"%",t)){var c=document.getElementById(t);c&&r&&(c.textContent=r(n))}}function Pe(e,t,n,i,o,r,a){var c=document.getElementById(e),d=document.getElementById(t);if(c&&d){Oe(t,n,r.current,i,o,a),c.addEventListener("click",function(e){e.target!==d&&l(e)});var s=!1;d.addEventListener("mousedown",function(e){e.preventDefault(),s=!0}),document.addEventListener("mousemove",function(e){s&&l(e)}),document.addEventListener("mouseup",function e(){s&&(s=!1),document.removeEventListener("mousemove",move),document.removeEventListener("mouseup",e)})}function l(e){var d=c.getBoundingClientRect(),s=e.clientX-d.left,l=function(e,t,n){return Math.round(e/100*(n-t)+t)}(Math.max(0,Math.min(100,s/d.width*100)),i,o);r.current=l,Oe(t,n,l,i,o,a)}}function Ne(t,n,i,o,r,a){var c=document.getElementById(t),d=document.getElementById(n);document.getElementById(i);if(c&&d){De(n,a.current,o),c.addEventListener("click",function(e){e.target!==d&&l(e)});var s=!1;d.addEventListener("mousedown",function(e){e.preventDefault(),s=!0}),document.addEventListener("mousemove",function(e){s&&l(e)}),document.addEventListener("mouseup",function e(){s&&(s=!1),document.removeEventListener("mousemove",move),document.removeEventListener("mouseup",e)})}function l(t){var i,d=c.getBoundingClientRect(),s=t.clientX-d.left,l=(i=s/d.width*100,Math.round(Math.max(0,Math.min(200,i/100*200))));a.current=l,"audioInputVolume"===r&&(Ce=l),De(n,l,o),function(e,t){"audioInputVolume"===e&&Me&&(Me.gain.value=t/100)}(r,l),function(t,n){e.getDevicePreferences&&e.setDevicePreferences&&e.getDevicePreferences().then(function(i){i[t]=n,e.setDevicePreferences(i),e.requestApplyDevicePreferences&&e.requestApplyDevicePreferences()})}(r,l)}}var qe=!1,Ue=!1;function Ge(){var e=document.getElementById("device-ptt-display");e&&(e.textContent=function(e){if(!e)return"Not set";if(0===e.indexOf("Mouse"))return"Mouse "+e.slice(5);if(0===e.indexOf("Key")){var t=e.slice(3);return t.length,t}return e}(je),je?e.classList.add("is-set"):e.classList.remove("is-set"))}function Re(t){je=t||void 0,e.getDevicePreferences&&e.setDevicePreferences&&e.getDevicePreferences().then(function(t){t.pttBinding=je,e.setDevicePreferences(t)})}function He(){var e=document.getElementById("device-ptt-set"),t=document.getElementById("device-ptt-display");function n(t){e.classList.remove("listening"),e.textContent="Set key",t?(Re(t),Ge()):Ge(),document.removeEventListener("keydown",i,!0),document.removeEventListener("mousedown",o,!0)}function i(e){if("Escape"===e.key)return e.preventDefault(),void n(null);e.preventDefault(),e.stopPropagation();var t=e.code||(1===e.key.length?"Key"+e.key.toUpperCase():e.key);0===t.indexOf("Key")&&n(t)}function o(e){0!==e.button&&2!==e.button&&(e.preventDefault(),e.stopPropagation(),n("Mouse"+e.button))}e&&t&&(e.classList.add("listening"),e.textContent="Press key or buttonâ€¦",t.textContent="Listeningâ€¦",document.addEventListener("keydown",i,!0),document.addEventListener("mousedown",o,!0))}var je=void 0,Ve=null;function Fe(){e.getDevicePreferences&&navigator.mediaDevices&&e.getDevicePreferences().then(function(e){je=e&&e.pttBinding||void 0,Ve={audioInput:e&&e.audioInput,videoInput:e&&e.videoInput,audioInputVolume:e&&null!=e.audioInputVolume?e.audioInputVolume:100,noiseSuppression:!(!e||!e.noiseSuppression),noiseGateOpenThreshold:e&&null!=e.noiseGateOpenThreshold?e.noiseGateOpenThreshold:-50,noiseGateCloseThreshold:e&&null!=e.noiseGateCloseThreshold?e.noiseGateCloseThreshold:-60,noiseGateHoldMs:e&&null!=e.noiseGateHoldMs?e.noiseGateHoldMs:50,pttBinding:e&&e.pttBinding};var t=document.getElementById("device-adaptive-noise");t&&(t.checked=Ve.noiseSuppression),function(e){we=e&&null!=e.noiseGateOpenThreshold?Math.max(-60,Math.min(-20,e.noiseGateOpenThreshold)):-50,Ae=e&&null!=e.noiseGateCloseThreshold?Math.max(-70,Math.min(-40,e.noiseGateCloseThreshold)):-60,Se=e&&null!=e.noiseGateHoldMs?Math.max(20,Math.min(200,e.noiseGateHoldMs)):50;var t={current:we},n={current:Ae},i={current:Se};Oe("device-noise-open-puck","device-noise-open-label",we,-60,-20,function(e){return e+" dB"}),Oe("device-noise-close-puck","device-noise-close-label",Ae,-70,-40,function(e){return e+" dB"}),Oe("device-noise-hold-puck","device-noise-hold-label",Se,20,200,function(e){return e+" ms"}),Ue||(Ue=!0,Pe("device-noise-open-track","device-noise-open-puck","device-noise-open-label",-60,-20,t,function(e){return we=e,e+" dB"}),Pe("device-noise-close-track","device-noise-close-puck","device-noise-close-label",-70,-40,n,function(e){return Ae=e,e+" dB"}),Pe("device-noise-hold-track","device-noise-hold-puck","device-noise-hold-label",20,200,i,function(e){return Se=e,e+" ms"}))}(e),Ge(),function(e){De("device-input-puck",Ce=e&&null!=e.audioInputVolume?e.audioInputVolume:100,"device-input-volume-pct"),qe||(qe=!0,Ne("device-input-track","device-input-puck","device-input-fill","device-input-volume-pct","audioInputVolume",{current:Ce}))}(e);var n=document.getElementById("device-input"),i=document.getElementById("device-webcam");function o(t){var n=(t||[]).filter(function(e){return"audioinput"===e.kind}),i=(t||[]).filter(function(e){return"videoinput"===e.kind});xe("device-input",n,0,e&&e.audioInput),xe("device-webcam",i,0,e&&e.videoInput)}n&&i&&navigator.mediaDevices.enumerateDevices().then(function(e){(e||[]).some(function(e){return!e.label})?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(t){t.getTracks().forEach(function(e){e.stop()}),navigator.mediaDevices.enumerateDevices().then(o).catch(function(){o(e)})}).catch(function(){o(e||[])}):o(e||[])}).catch(function(){o([])})})}function We(e){if(e&&e.value&&"none"!==e.value&&e.options&&e.options[e.selectedIndex]){var t=e.options[e.selectedIndex].textContent;return t&&t.trim()||void 0}}var ze=null,Xe=null,Ke=null,Ye=null;function Je(){ze&&(ze.getTracks().forEach(function(e){e.stop()}),ze=null),Xe&&Xe.srcObject&&(Xe.srcObject.getTracks().forEach(function(e){e.stop()}),Xe.srcObject=null),Ke&&(Ke.close().catch(function(){}),Ke=null),Ye&&(cancelAnimationFrame(Ye),Ye=null),Me=null;var e=document.getElementById("device-input-fill");e&&(e.style.display="none",e.style.width="0"),Te&&(Te.textContent="Test",Te.classList.remove("device-test-btn-stop"),Te=null)}function Qe(e,t){var n=document.getElementById(e);n&&(n.innerHTML="",t&&t.nodeType&&n.appendChild(t))}var Ze,$e,_e,et,tt=-60;function nt(e,t){var n=(e-tt)/60;return Math.max(0,Math.min(t,n*t))}function it(){var e=document.getElementById("device-input-test"),t=document.getElementById("device-input"),n="device-input-test-panel",i=document.getElementById("device-input-fill");if(t&&navigator.mediaDevices){if(Te===e)return Je(),void Qe(n,null);if(Je(),"none"!==t.value&&""!==t.value){var o,r={audio:!t.value||{deviceId:{exact:t.value}}};navigator.mediaDevices.getUserMedia(r).then(function(t){ze=t;var o=document.getElementById(n);if(o){o.innerHTML="",i&&(i.style.display="block",i.style.width="0",i.style.backgroundColor="#3b82f6"),e&&(Te=e,e.textContent="Stop",e.classList.add("device-test-btn-stop"));var r=new(window.AudioContext||window.webkitAudioContext);Ke=r;var a=r.createMediaStreamSource(t),c=r.createGain();c.gain.value=Ce/100,Me=c;var d=r.createAnalyser();d.fftSize=256,d.smoothingTimeConstant=.8,a.connect(c),c.connect(d);var s=new Uint8Array(d.frequencyBinCount),l=document.getElementById("device-input-track");!function e(){if(ze){d.getByteFrequencyData(s);for(var t=0,n=0;n<s.length;n++)t+=s[n];var o,r=t/s.length/255,a=(o=r)<=0?tt:Math.max(tt,20*Math.log10(o));if(i&&l){var c=l.getBoundingClientRect().width;i.style.width=nt(a,c)+"px"}Ye=requestAnimationFrame(e)}}()}}).catch(function(e){Qe(n,function(){var t=document.createElement("p");return t.className="device-test-msg",t.textContent="Could not access device: "+(e.message||e.name||"Unknown error"),t}())})}else Qe(n,((o=document.createElement("p")).className="device-test-msg",o.textContent="none"===t.value?"None selected â€” no device to test.":"Select a device to test.",o))}}function ot(){var e=document.getElementById("device-webcam-test"),t=document.getElementById("device-webcam"),n="device-webcam-test-panel";if(t&&navigator.mediaDevices){if(Te===e)return Je(),void Qe(n,null);if(Je(),"none"!==t.value&&""!==t.value){var i,o={video:!t.value||{deviceId:{exact:t.value}}};navigator.mediaDevices.getUserMedia(o).then(function(t){ze=t;var i=document.getElementById(n);if(i){i.innerHTML="",e&&(Te=e,e.textContent="Stop",e.classList.add("device-test-btn-stop"));var o=document.createElement("video");o.autoplay=!0,o.muted=!0,o.playsInline=!0,o.srcObject=t,Xe=o,i.appendChild(o)}}).catch(function(e){Qe(n,function(){var t=document.createElement("p");return t.className="device-test-msg",t.textContent="Could not access camera: "+(e.message||e.name||"Unknown error"),t}())})}else Qe(n,((i=document.createElement("p")).className="device-test-msg",i.textContent="none"===t.value?"None selected â€” no device to test.":"Select a device to test.",i))}}function rt(){if(e.setDevicePreferences){Je(),je=void 0;var t={audioInput:void 0,videoInput:void 0,audioInputLabel:void 0,videoInputLabel:void 0,audioInputVolume:100,noiseSuppression:!1,noiseGateOpenThreshold:void 0,noiseGateCloseThreshold:void 0,noiseGateHoldMs:void 0,pttBinding:void 0};e.setDevicePreferences(t),e.requestApplyDevicePreferences&&e.requestApplyDevicePreferences(),Fe()}}function at(){if(e.setDevicePreferences){var t=document.getElementById("device-input"),n=document.getElementById("device-webcam"),i=document.getElementById("device-adaptive-noise"),o={audioInput:t&&t.value||void 0,videoInput:n&&n.value||void 0,audioInputLabel:We(t),videoInputLabel:We(n),audioInputVolume:Ce,noiseSuppression:!(!i||!i.checked),noiseGateOpenThreshold:we,noiseGateCloseThreshold:Ae,noiseGateHoldMs:Se,pttBinding:je},r=function(){if(!Ve)return!1;var e=document.getElementById("device-input"),t=document.getElementById("device-webcam"),n=document.getElementById("device-adaptive-noise"),i=e&&e.value||void 0,o=t&&t.value||void 0,r=Ce,a=!(!n||!n.checked),c=we,d=Ae,s=Se,l=je;return i!==Ve.audioInput||o!==Ve.videoInput||r!==Ve.audioInputVolume||a!==Ve.noiseSuppression||c!==Ve.noiseGateOpenThreshold||d!==Ve.noiseGateCloseThreshold||s!==Ve.noiseGateHoldMs||l!==Ve.pttBinding}();if(be(),e.setDevicePreferences(o),e.requestApplyDevicePreferences&&e.requestApplyDevicePreferences(),r){var a=document.getElementById("reconnect-modal");a&&a.classList.add("open")}}}function ct(){e.getServers().then(function(t){s=Array.isArray(t)?t:[];var n=u;0===s.length?(u=null,l="https://demo.sharkord.com",e.setServerUrl(l)):n&&s.find(function(e){return e.id===n})||(u=s[0].id,l=s[0].url,e.setServerUrl(s[0].url)),h(),_()})}!function(){var e=document.getElementById("device-settings-modal"),t=document.getElementById("device-settings-reset"),n=document.getElementById("device-settings-cancel"),i=document.getElementById("device-settings-save");if(e&&n&&i){t&&t.addEventListener("click",rt),n.addEventListener("click",be),i.addEventListener("click",at);var o=document.getElementById("device-ptt-set"),r=document.getElementById("device-ptt-reset");o&&o.addEventListener("click",He),r&&r.addEventListener("click",function(){Re(void 0),Ge()});var a=document.getElementById("device-input-test"),c=document.getElementById("device-webcam-test");a&&a.addEventListener("click",it),c&&c.addEventListener("click",ot),e.addEventListener("click",function(t){t.target===e&&be()}),document.addEventListener("keydown",function(t){"Escape"===t.key&&e.classList.contains("open")&&be()})}}(),function(){var t=document.getElementById("add-server-modal"),n=document.getElementById("add-server-input"),i=document.getElementById("add-server-cancel"),o=document.getElementById("add-server-add");i.addEventListener("click",te),o.addEventListener("click",ne),n.addEventListener("keydown",function(e){"Enter"===e.key&&ne(),"Escape"===e.key&&te()}),t.addEventListener("click",function(e){e.target===t&&te()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("open")&&te()}),e.onOpenAddServerModal&&e.onOpenAddServerModal(ee)}(),function(){var t=document.getElementById("about-modal"),n=document.getElementById("about-close");function i(){t.classList.remove("open")}t&&n&&(n.addEventListener("click",i),t.addEventListener("click",function(e){e.target===t&&i()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("open")&&i()}),e.onOpenAboutModal&&e.onOpenAboutModal(function(){e.getAppVersion().then(function(e){var n=document.getElementById("about-version");n&&(n.textContent=e?"Version "+e:""),t.classList.add("open")})}))}(),function(){var e=document.getElementById("add-server-confirm-modal"),t=document.getElementById("add-server-confirm-cancel"),n=document.getElementById("add-server-confirm-add");e&&t&&n&&(t.addEventListener("click",Le),n.addEventListener("click",ke),e.addEventListener("click",function(t){t.target===e&&Le()}),document.addEventListener("keydown",function(t){"Escape"===t.key&&e.classList.contains("open")&&Le()}))}(),function(){var t=document.getElementById("copy-text-modal"),n=document.getElementById("copy-text-close"),i=document.getElementById("copy-text-copy"),o=document.getElementById("copy-text-input");t&&n&&i&&o&&(n.addEventListener("click",Ie),i.addEventListener("click",function(){var t=o.value;t&&e&&e.copyToClipboard&&e.copyToClipboard(t),Ie()}),t.addEventListener("click",function(e){e.target===t&&Ie()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("open")&&Ie()}))}(),function(){var t=document.getElementById("clear-servers-modal"),n=document.getElementById("clear-servers-cancel"),i=document.getElementById("clear-servers-confirm");function o(){t.classList.remove("open")}t&&n&&i&&(n.addEventListener("click",o),i.addEventListener("click",function(){e&&e.confirmClearServers&&e.confirmClearServers(),o()}),t.addEventListener("click",function(e){e.target===t&&o()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("open")&&o()}),e&&e.onOpenClearServersModal&&e.onOpenClearServersModal(function(){t.classList.add("open")}))}(),function(){var t=document.getElementById("remove-server-modal"),n=document.getElementById("remove-server-cancel"),i=document.getElementById("remove-server-confirm");function o(){t.classList.remove("open"),C=null}t&&n&&i&&(n.addEventListener("click",o),i.addEventListener("click",function(){var t=C;o(),t&&e&&e.removeServer&&(e.removeServer(t),ct())}),t.addEventListener("click",function(e){e.target===t&&o()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("open")&&o()}))}(),function(){var t=document.getElementById("reconnect-modal"),i=document.getElementById("reconnect-cancel"),o=document.getElementById("reconnect-confirm");function r(){t.classList.remove("open")}t&&i&&o&&(i.addEventListener("click",r),o.addEventListener("click",function(){if(r(),e.reloadForReconnect)e.reloadForReconnect();else{var t=g();if(t&&t.url&&n){var i=n.querySelector('.client-frame[data-server-id="'+t.id+'"]');i&&(i.src=t.url)}}}),t.addEventListener("click",function(e){e.target===t&&r()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("open")&&r()}))}(),function(){var e=document.getElementById("change-icon-modal"),t=document.getElementById("change-icon-input"),n=document.getElementById("change-icon-emoji-btn"),i=document.getElementById("change-icon-emoji-picker"),o=document.getElementById("change-icon-image-btn"),r=document.getElementById("change-icon-file"),a=document.getElementById("change-icon-preview-wrap"),c=document.getElementById("change-icon-preview"),d=document.getElementById("change-icon-clear-image");document.getElementById("change-icon-cancel").addEventListener("click",se),document.getElementById("change-icon-save").addEventListener("click",le),o&&r&&(o.addEventListener("click",function(){r.click()}),r.addEventListener("change",function(){var e=r.files&&r.files[0];if(e&&e.type.startsWith("image/")){var n=new FileReader;n.onload=function(){A=n.result,a&&c&&(c.src=A,a.classList.add("visible")),t.value=""},n.readAsDataURL(e),r.value=""}})),d&&a&&d.addEventListener("click",function(){A=null,a.classList.remove("visible"),c&&c.removeAttribute("src"),t.placeholder="Emoji or letter",t.focus()}),n.addEventListener("click",function(e){e.stopPropagation(),i.classList.toggle("open")}),document.addEventListener("click",function(){i.classList.remove("open")}),i.addEventListener("click",function(e){e.stopPropagation()}),t.addEventListener("keydown",function(e){"Enter"===e.key&&le(),"Escape"===e.key&&se()}),e.addEventListener("click",function(t){t.target===e&&se()})}(),function(){document.getElementById("server-context-menu");document.getElementById("context-change-icon").addEventListener("click",function(){var e=k;fe(),e&&de(e)}),document.getElementById("context-keep-connected").addEventListener("click",function(){var t=k;if(fe(),t){var n=s.find(function(e){return e.id===t});n&&e.updateServer(t,{keepConnected:!n.keepConnected}).then(function(e){Array.isArray(e)?(s=e,h(),_()):ct()})}}),document.getElementById("context-remove").addEventListener("click",function(){var e=k;if(fe(),e){var t=s.find(function(t){return t.id===e});if(t){var n=document.getElementById("remove-server-confirm-text");n&&(n.textContent='Remove "'+(t.name||"Server")+'" from list?'),C=e;var i=document.getElementById("remove-server-modal");i&&i.classList.add("open")}}}),document.addEventListener("click",function(){fe(),pe(),ve()});var t=document.getElementById("context-menu-backdrop");t&&t.addEventListener("click",function(){fe(),pe(),ve()})}(),Ze=document.getElementById("iframe-context-menu"),$e=document.getElementById("iframe-ctx-copy"),_e=document.getElementById("iframe-ctx-paste"),et=document.getElementById("iframe-ctx-download-image"),Ze&&$e&&_e&&et&&($e.addEventListener("click",function(){var t=B;pe(),t&&e.copyToClipboard&&e.copyToClipboard(t)}),_e.addEventListener("click",function(){var t=x;pe(),t&&e.getClipboardText&&e.getClipboardText().then(function(e){if(e&&t.contentWindow)try{t.contentWindow.postMessage({type:"sharkord-iframe-paste",text:e},"*")}catch(e){}})}),et.addEventListener("click",function(){var t=b;pe(),t&&e.downloadUrl&&e.downloadUrl(t)})),(e.getServerUrl?e.getServerUrl():Promise.resolve("https://demo.sharkord.com")).then(function(t){l=t||"https://demo.sharkord.com",e.getServers().then(function(t){if(s=Array.isArray(t)?t:[],s.length>0){var n=s.find(function(e){return f(e.url)===f(l)});n?(u=n.id,l=n.url):(u=s[0].id,l=s[0].url,e.setServerUrl(s[0].url))}else u=null;h(),_()})}),e.onNavigate&&e.onNavigate(function(e){l=e;var n=s.find(function(t){return f(t.url)===f(e)});n?(u=n.id,h()):h(),_(),function(){if(null!==M){var e=t.querySelector('.server-btn[data-server-id="'+M+'"]');if(e){M=null;var n=document.createElement("span");n.className="ripple",e.insertBefore(n,e.firstChild),n.animate([{transform:"translate(-50%, -50%) scale(0)"},{transform:"translate(-50%, -50%) scale(2)"}],{duration:1e3,easing:"ease-out",fill:"forwards"}).onfinish=function(){e.style.transition="none",e.style.background="#3b82f6",n.style.opacity="0",n.style.pointerEvents="none",e.offsetHeight,setTimeout(function(){n.parentNode&&n.parentNode.removeChild(n),e.classList.remove("ripple-pending"),e.classList.add("active"),e.style.transition=""},120)}}}}()})}();